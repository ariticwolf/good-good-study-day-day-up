<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>日期选择</title>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; line-height: 1; }
		.date-picker {
			width: 310px;
			box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
			margin: 20px;
		}
		.date-head {
			width: 100%;
			height: 100px;
			background: #2196f3;
			padding: 15px 24px;
			display: none;
		}
		.date-head .year {
			color: #fff;
			font-size: 16px;
			font-weight: 500;
			opacity: 0.7;
		}
		.date-head .month {
			color: #fff;
			font-size: 36px;
			font-weight: 500;
			margin-top: 10px;
		}
		.date-con {
			width: 100%;
			height: 310px;
			background: #fff;
			padding: 0 8px 8px;
		}
		.date-con .toolbar {
			height: 48px;
			display: flex;
			justify-content: space-between;
			align-self: center;
		}
		.date-con .toolbar i {
			color: #666;
			font-size: 14px;
			font-style: normal;
			font-weight: bold;
			line-height: 48px;
			text-align: center;
			padding: 0 5px;
			cursor: pointer;
		}
		.date-con .toolbar i:hover {
			color: #2196f3;
		}
		.date-con .toolbar p {
			flex: 1;
			color: #666;
			font-size: 14px;
			font-weight: bold;
			line-height: 48px;
			text-align: center;
		}
		.date-con .toolbar p b {
			cursor: pointer;
		}
		.date-con .toolbar p b:hover {
			color: #2196f3;
		}
		.date-con .week {
			height: 25px;
			font-size: 14px;
			color: #999;
			border-bottom: 1px solid #ebeef5;
			display: flex;
			justify-content: space-around;
			margin: 5px auto;
		}
		.date-con .week span {
			flex: 1;
			text-align: center;
		}
		.date-con .date {
			margin-top: 10px;
		}
		.date-con .date .row {
			height: 34px;
			display: flex;
			justify-content: space-around;
			align-content: center;
			margin-bottom: 2px;
		}
		.date-con .date .row span {
			width: 34px;
			line-height: 34px;
			text-align: center;
			border-radius: 34px;
			font-size: 14px;
			color: #333;
			cursor: pointer;
			transition: all 0.45s cubic-bezier(.23,1,.32,1);
		}
		.date-con .date .row span.pre, .date-con .date .row span.next {
			color: #999;
		}
		.date-con .date .row span:hover {
			color: #fff;
			background: #2196f3;
			opacity: 0.6;
		}
		.date-con .date .row span.selected {
			color: #fff;
			background: #2196f3;
		}
	</style>
</head>
<body>
	<div class="date-picker">
		<div class="date-head">
			<div class="year">2021</div>
			<div class="month">06-05 星期六</div>
		</div>
		<div class="date-con">
			<div class="toolbar">
				<i class="preYear">《</i>
				<i class="preMonth">〈</i>
				<p class="curSelect"><b>2021 年</b> <b>6 月</b></p>
				<i class="nextMonth">〉</i>
				<i class="nextYear">》</i>
			</div>
			<div class="week">
				<span>日</span>
				<span>一</span>
				<span>二</span>
				<span>三</span>
				<span>四</span>
				<span>五</span>
				<span>六</span>
			</div>
			<div class="date">
				<!-- <p class="row">
					<span class="current">32</span>
					<span>32</span>
					<span>32</span>
					<span>32</span>
					<span>32</span>
					<span>32</span>
					<span>32</span>
				</p> -->
			</div>
		</div>
	</div>

	<script src="https://unpkg.com/vue@next"></script>
	<script type="text/javascript">
		/*
			结构 => 六横七列

			思路 => 

			1、计算传入的时间的当月第一天是星期几

			2、推算出第一行第一个数据日期是从几号开始的，星期几前面就补

			3、用一个42位的数组存放每日的数据信息（上月、本月、下月）
		*/
		const dateBox = document.querySelector(".date");

		let selectedTime = new Date();
		let year = selectedTime.getFullYear();
		let month = selectedTime.getMonth();
		let date = selectedTime.getDate();

		console.log(year, month, date)

		generateDate(selectedTime)
		function generateDate (selectedTime = new Date()) {
			let year = selectedTime.getFullYear();
			let month = selectedTime.getMonth();
			let date = selectedTime.getDate();

			let firstDayOfMonth = new Date(year, month, 1); // 当月第一天时间
			let week = new Date(year, month, 1).getDay();  // 当月第一天星期几

			let startDay = firstDayOfMonth - week * 24 * 60 * 60 * 1000; // 计算出开始时间戳
			// console.log(week, startDay, firstDayOfMonth, new Date(startDay).getDate());

			let dayList = [];
			for (let i = 0; i < 42; i++) {
				let timestamp = startDay + i * 24 * 60 * 60 * 1000; // 开始时间戳

				let initDate = new Date(timestamp).getDate();  // 日期
				let initMonth = new Date(timestamp).getMonth();  // 月份
				let initYear = new Date(timestamp).getFullYear();  // 年份

				dayList.push({
					date: initDate,
					month: initMonth + 1,
					year: initYear,
					type: monthType(timestamp),
				})
			}
			console.log(dayList)

			renderDom(dayList)
		}

		function renderDom (dayList) {
			dateBox.innerHTML = "";

			let frag = document.createDocumentFragment();
			for (let i = 0; i < 6; i++) {
				let p = document.createElement('p');
				p.classList.add("row");
				for (let j = 0; j < 7; j++) {
					let span = document.createElement("span");
					let isToday = dayList[i * 7 + j].year === year && dayList[i * 7 + j].month === month + 1 && dayList[i * 7 + j].date === date;
					span.className = `${dayList[i * 7 + j].type} ${isToday?'selected':''}`;
					span.setAttribute("date",`${dayList[i * 7 + j].year}-${dayList[i * 7 + j].month}-${dayList[i * 7 + j].date}`)
					span.innerText = `${dayList[i * 7 + j].date}`;
					p.appendChild(span);
				}
				frag.appendChild(p);
			}
			dateBox.appendChild(frag);
		}

		// 计算月份是当月、上月还是下月
		function monthType (timestamp) {
			let paramMonth = new Date(timestamp).getMonth();
			let selectMonth = new Date(selectedTime).getMonth();
			if (paramMonth > selectMonth) {
				return new Date(timestamp) < new Date(selectedTime) ? "pre" : "next";
			} else if (paramMonth < selectMonth) {
				return new Date(timestamp) > new Date(selectedTime) ? "next" : "pre";
			} else {
				return "cur";
			}
		}

		dateBox.addEventListener("click", e => {
			// console.log(e, e.target)
			if (e.target.tagName === "SPAN") {
				// console.log(e.target.tagName)
				// e.target.classList.add("selected")
				let date = e.target.getAttribute("date")
				console.log(date)
				selectedTime = new Date(date)
				year = selectedTime.getFullYear();
				month = selectedTime.getMonth();
				date = selectedTime.getDate();
				generateDate(selectedTime)
			}
		})

	</script>
</body>
</html>